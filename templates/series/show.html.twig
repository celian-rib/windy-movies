{% extends 'nav.html.twig' %}

{% block title %}
	{{ serie.title }}
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link href="{{ asset('stylesheets/content.css') }}" rel="stylesheet">
	<link href="{{ asset('stylesheets/seriepage.css') }}" rel="stylesheet">
{% endblock %}

{% set curr_season = app.request.get('season') ?? 1 %}

{% block app %}
	<div id="serie-header">
		<img src="{{ path('series_poster', {'id': serie.id}) }}"/>
		<span></span>
		<div>
			<h1>{{ serie.title }}</h1>
			{% if app.user %}
				<form method="POST" action="#serie-header">
					<input type="hidden" name="toast" value="{{ is_following ? "Serie removed from your library" : "Serie added to your library" }}">
					<input type="submit" value="{{ is_following ? "Unfollow" : "Follow" }}" class="button {{ is_following ? " shadow" : " orange-highlight" }}"/>
				</form>
			{% endif %}
		</div>
	</div>

	<div id="header-spacer"></div>

	<div id="plot" class="influx-container">
		{{ serie.plot }}
	</div>

	<div id="serie-info" class="influx-container slot-background shadow">
		<div>
			<p>
				<span>Awards :
				</span>
				{{ serie.awards }}</p>
			<p>
				<span>Year :
				</span>
				{{ serie.yearStart }}
				{{ serie.yearEnd ?? "" }}</p>
			<p>
				<span>Seasons :
				</span>
				{{ serie.getSeasons()|length }}</p>
			<p>
				<span>Director :
				</span>
				{{ serie.director ?? "unknown" }}</p>
			<div id="rating-slot">
				<span>Rating :
				</span>
				{% for i in range(1, 5) %}
					<p>{{ i < serie.getAvgRatingsValue() / 2 ? "★" : "☆" }}</p>
				{% endfor %}
			</div>
		</div>
		<img src="{{ path('series_poster', {'id': serie.id}) }}"/>
	</div>

	<form id="search-header" style="justify-content: flex-start;" class="influx-container" action="#episodes" method="GET">
		<div class="form-input-container">
			<select onchange="this.form.submit()" name="season">
				{% for season in serie.getSeasons() %}
					<option {{ curr_season == season.number ? 'selected' }} value="{{ season.number }}">Season
						{{ season.number }}</option>
				{% endfor %}
			</select>
		</div>
	</form>

	<div id="episodes" class="influx-container slot-background shadow">
		{% for episode in serie.getSeason(curr_season).getEpisodes() %}
			<div class="episode-item">
				<div>
					<p>#{{ episode.getNumber() }}</p>
					<h1>{{ episode.getTitle() }}</h1>
				</div>
				{% if app.user %}
					<form id="ep{{ episode.id }}" method="POST" action="#ep{{ episode.id }}">
						<input type="hidden" name="episode" value="{{ episode.id }}">
						{% if episode.seenByUser(app.user) %}
							<input type="hidden" name="toast" value="Episode marked as not watched">
							<input type="submit" value="Remove from watched" style="color: rgba(255, 255, 255, 0.4)" class="button"/>
						{% else %}
							<input type="hidden" name="toast" value="Episode marked as watched">
							<input type="submit" value="✓ Mark as watched" style="color: #ff9c38" class="button"/>
						{% endif %}
					</form>
				{% endif %}
			</div>
		{% endfor %}
	</div>
{% endblock %}
